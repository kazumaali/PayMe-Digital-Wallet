<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="CONTENT-TYPE" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="payme.css">
    <title>PayMe</title>
</head>
<body>
    <section class="wallet" id="wallet">
        <h2 class="balance-d" id="Dollar">0$</h2>
        <h2 class="balance-r" id="Rial">0﷼</h2>
        <h2 class="balance-t" id="Tether">0T</h2>
        
        <nav>
            <button class="withdraw" id="withdraw" onclick="withdrawM()"><a href="withdraw.html">سحب</a></button>
            <button class="recieve" id="recieve" onclick="recieveM()"><a href="recieve.html">تلقي</a></button>
            <button class="send" id="send" onclick="sendM()"><a href="send.html">إرسال</a></button>
            <button class="exchange" id="exchange" onclick="exchangeM()"><a href="exchange.html">تحويل الممتلكات</a></button>
        </nav>
    </section>
    
    <section>
        <table class="usd-price" id="usdP">
            <tr>
                <td id="RIAL">0﷼</td>
                <td id="USD">USD</td>
            </tr>
        </table>
    </section>

    <script>
        // بيانات المستخدم (سنغير هذا لاحقاً لنظام تسجيل الدخول)
        const CURRENT_USER_ID = 1;

        // جلب أرصدة المستخدم من الخادم
        async function loadBalances() {
            try {
                const response = await fetch(`http://localhost:5000/api/balance/${CURRENT_USER_ID}`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('Dollar').textContent = data.balances.USD + '$';
                    document.getElementById('Rial').textContent = data.balances.IRR + '﷼';
                    document.getElementById('Tether').textContent = data.balances.USDT + 'T';
                }
            } catch (error) {
                console.error('خطأ في جلب الأرصدة:', error);
            }
        }

        // جلب أسعار الصرف من الخادم
        async function loadExchangeRates() {
            try {
                const response = await fetch('http://localhost:5000/api/exchange-rate');
                const data = await response.json();
                
                if (data.success) {
                    const usdToIrr = data.rates.USD_TO_IRR;
                    document.getElementById('RIAL').textContent = usdToIrr.toLocaleString() + '﷼';
                    document.getElementById('USD').textContent = '1 USD =';
                }
            } catch (error) {
                console.error('خطأ في جلب أسعار الصرف:', error);
            }
        }

        // تحديث البيانات كل 10 ثواني
        function startAutoRefresh() {
            loadBalances();
            loadExchangeRates();
            setInterval(() => {
                loadBalances();
                loadExchangeRates();
            }, 10000); // كل 10 ثواني
        }

        // تشغيل عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            startAutoRefresh();
        });

        // دوال الأزرار (سيتم تطويرها لاحقاً)
        function withdrawM() {
            console.log('فتح صفحة السحب');
        }

        function recieveM() {
            console.log('فتح صفحة الاستقبال');
        }

        function sendM() {
            console.log('فتح صفحة الإرسال');
        }

        function exchangeM() {
            console.log('فتح صفحة التحويل');
        }
    </script>
</body>
</html>